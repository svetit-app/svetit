<h1 i18n="@@SPACES.LIST.HEADING">Пространства</h1>
<ng-container *ngIf="invitationsTotal > 0">
	<hr class="width-and-clear">
	<h2 i18n="@@SPACES.LIST.INVITATIONS.HEADING">Приглашения</h2>
	<div #scrollToInvitationForm class="spaces-invitations-wrap">
		<!-- form for inviting user -->
		<div class="float-row-with-padding" *ngIf="!isInvitationFormHidden">
			<form [formGroup]="invitationForm" (ngSubmit)="onSubmitInvitation()">
				<div class="left-float vertical-align">
					<span>{{invitationFormSpaceName}}</span>
				</div>
				<div class="left-float left-padding-10">
					<mat-form-field appearance="fill">
						<input matInput type="text" formControlName="login" [matAutocomplete]="auto" required />
						<mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectUser($event.option)" [displayWith]="displayUserLogin">
							<mat-option *ngFor="let user of users$ | async" [value]="user">
								{{ user.login }}
							</mat-option>
						</mat-autocomplete>
						<mat-hint i18n="@@SPACES.LIST.INVITATIONS.ADDFORM.LOGIN">Логин пользователя</mat-hint>
					</mat-form-field>
				</div>
				<div class="left-float left-padding-10">
					<mat-form-field>
						<mat-select formControlName="role">
							<mat-option value="admin" i18n="@@SPACES.LIST.INVITATIONS.ADDFORM.ROLES.ADMIN">Администратор</mat-option>
							<mat-option value="user" i18n="@@SPACES.LIST.INVITATIONS.ADDFORM.ROLES.USER">Пользователь</mat-option>
							<mat-option value="guest" i18n="@@SPACES.LIST.INVITATIONS.ADDFORM.ROLES.GUEST" selected>Гость</mat-option>
						</mat-select>
						<mat-hint i18n="@@SPACES.LIST.INVITATIONS.ADDFORM.ROLE">Роль</mat-hint>
					</mat-form-field>
				</div>
				<div class="left-float left-padding-10"><button mat-icon-button type="submit"><mat-icon>done</mat-icon></button></div>
				<div class="left-float left-padding-10"><button mat-icon-button (click)="onInvitationFormCloseBtn()"><mat-icon>close</mat-icon></button></div>
			</form>
		</div> <!-- end form for inviting user -->

		<!-- listing invitations -->
		<div *ngFor="let invitation of invitations" class="float-row-with-padding">
			<div class="left-float">{{invitation.spaceName}}</div>
			<div *ngIf="invitation.userId != currentUserId" class="left-float left-padding-10">{{invitation.userLogin}}</div>
			<div *ngIf="invitation.userId != currentUserId" class="left-float left-padding-10">
				<mat-form-field>
					<mat-select [(ngModel)]="invitation.role">
						<mat-option value="admin" i18n="@@SPACES.LIST.ADMINROLE">Администратор</mat-option>
						<mat-option value="user" i18n="@@SPACES.LIST.USERROLE">Пользователь</mat-option>
						<mat-option value="guest" i18n="@@SPACES.LIST.GUESTROLE">Гость</mat-option>
					</mat-select>
				</mat-form-field>
			</div>

			<div *ngIf="invitation.creatorId != invitation.userId && invitation.userId == currentUserId" class="left-float left-padding-10"><button mat-raised-button class="bright-button" i18n="@@SPACES.LIST.INVITATIONS.JOINBTN">Присоединиться</button></div>

			<div *ngIf="invitation.creatorId == invitation.userId && invitation.userId != currentUserId" class="left-float left-padding-10"><button mat-raised-button i18n="@@SPACES.LIST.INVITATIONS.APPROVEBTN">Одобрить</button></div>

			<div class="left-float left-padding-10"><button mat-icon-button (click)="onInvitationDelBtn(invitation)"><mat-icon>close</mat-icon></button></div>
		</div>
	</div>

	<mat-paginator #invitationsPaginator class="spaces-invitations-wrap" [length]="invitationsTotal" [pageSize]="pageSize.invitations" [pageSizeOptions]="[7, 15, 30, 100]" (page)="getInvitations($event.pageSize, $event.pageIndex)"></mat-paginator>
	<!-- end of listing invitations-->
</ng-container>

<ng-container *ngIf="linksTotal > 0">
	<hr class="width-and-clear">
	<h2 i18n="@@SPACES.LIST.LINKS.HEADING">Ссылки-приглашения</h2>
	<div class="width-and-clear" #scrollToLinkForm>
		<!-- form for creating link -->
		<div class="float-row-with-padding" *ngIf="!isLinkFormHidden">
			<form [formGroup]="linkForm" (ngSubmit)="onSubmitLink()">
				<div class="left-float vertical-align">
					<span>{{linkFormSpaceName}}</span>
				</div>
				<div class="left-float left-padding-10">
					<mat-form-field appearance="fill">
						<input matInput type="text" formControlName="name" required />
						<mat-hint i18n="@@SPACES.LIST.LINKS.ADDFORM.LINKNAME">Имя ссылки</mat-hint>
					</mat-form-field>
				</div>
				<div class="left-float left-padding-10">
					<mat-form-field appearance="fill">
						<input matInput type="date" formControlName="expiredAt" required />
						<mat-hint i18n="@@SPACES.LIST.LINKS.ADDFORM.EXPIREDATE">Срок действия</mat-hint>
					</mat-form-field>
				</div>
				<div class="left-float left-padding-10"><button mat-icon-button type="submit"><mat-icon>done</mat-icon></button></div>
				<div class="left-float left-padding-10"><button mat-icon-button (click)="onLinkFormCloseBtn()"><mat-icon>close</mat-icon></button></div>
			</form>
		</div> <!-- end form for creating link -->

		<!-- listing links -->
		<div *ngFor="let link of links" class="float-row-with-padding">
			<div class="left-float">{{link.spaceName}}</div>
			<div class="left-float left-padding-10">{{link.name}}</div>
			<div class="left-float left-padding-10">{{link.expiredAt | date}}</div>
			<div class="left-float left-padding-10"><button mat-raised-button i18n="@@SPACES.LIST.LINKS.COPYBTN" (click)="onLinkCopyBtn(link)">Копировать</button></div>
			<div class="left-float left-padding-10" (click)="onLinkDelBtn(link)"><button mat-icon-button><mat-icon>close</mat-icon></button></div>
		</div>
	</div>

	<mat-paginator #linksPaginator class="width-and-clear" [length]="linksTotal" [pageSize]="pageSize.links" [pageSizeOptions]="[7, 15, 30, 100]" (page)="getLinks($event.pageSize, $event.pageIndex)"></mat-paginator>
	<!-- end of listing links -->
</ng-container>

<!-- listing spaces -->
<hr class="width-and-clear">
<div class="spaces-heading">
	<h2 i18n="@@SPACES.LIST.SPACES.HEADING">Пространства</h2>
	<a routerLink="/space/add"><button class="mat-icon-button"><mat-icon>add</mat-icon></button></a>
</div>
<div class="width-and-clear">
	<div *ngFor="let space of spaces" class="float-row-with-padding">
		<div class="left-float"><a routerLink="/space/{{space.key}}">{{space.name}}</a></div>
		<div class="left-float left-padding-10">{{space.key}}</div>
		<div class="left-float left-padding-10"><button mat-icon-button (click)="onSpaceInvitationAddUser(space)"><mat-icon>person_add</mat-icon></button></div>
		<div class="left-float left-padding-10"><button mat-icon-button (click)="onSpaceAddLink(space)"><mat-icon>link</mat-icon></button></div>
		<div class="left-float left-padding-10"><button mat-icon-button (click)="onSpaceDelBtn(space)"><mat-icon>close</mat-icon></button></div>
	</div>
	<mat-paginator #spacesPaginator class="width-and-clear" [length]="spacesTotal" [pageSize]="pageSize.spaces" [pageSizeOptions]="[7, 15, 30, 100]" (page)="getSpaces($event.pageSize, $event.pageIndex)"></mat-paginator>
</div>
<!-- end of listing spaces -->
